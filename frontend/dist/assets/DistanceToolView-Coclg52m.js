import{m as N}from"./mqtt.esm-BKeQ4ejO.js";import{s as S,d as C,v as L,r as M,c as P,o as h,a as e,w as t,i as u,A as q,t as _,g as x,_ as V,e as F,b as B,f as Q,m as R,j as D,B as $,F as j}from"./index-DkkrOWQ5.js";import{u as b}from"./config-DlXkem2Y.js";/**
 * @license lucide-vue-next v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=S("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),E={class:"distance-calculator"},O={class:"distance-value"},U=C({__name:"DistanceDisplay",props:{deviceA:{},deviceB:{}},setup(I){const m=n=>typeof n!="number"||isNaN(n)?"0.00000000":n.toFixed(6),w=I,p=(n,l,v,r)=>{const a=n*Math.PI/180,c=l*Math.PI/180,o=v*Math.PI/180,i=r*Math.PI/180,d=o-a,f=i-c,y=Math.sin(d/2)**2+Math.cos(a)*Math.cos(o)*Math.sin(f/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(y),Math.sqrt(1-y)))},g=L(()=>{const{deviceA:n,deviceB:l}=w;return!n.lat||!n.lon||!l.lat||!l.lon?0:p(n.lat,n.lon,l.lat,l.lon).toFixed(2)});return(n,l)=>{const v=M("el-icon"),r=M("el-text"),s=M("el-col"),a=M("el-row");return h(),P("div",E,[e(a,null,{default:t(()=>[e(s,{span:9},{default:t(()=>[e(a,null,{default:t(()=>[e(s,{span:8,class:"id-column"},{default:t(()=>[e(r,{type:"primary",size:"large",tag:"b"},{default:t(()=>[e(v,null,{default:t(()=>[e(q(A))]),_:1}),u(" ID: "+_(n.deviceA.id),1)]),_:1})]),_:1}),e(s,{span:16},{default:t(()=>[e(a,null,{default:t(()=>[e(s,{span:6},{default:t(()=>[e(r,{class:"coord-label",type:"info",size:"small"},{default:t(()=>l[0]||(l[0]=[u("纬度")])),_:1})]),_:1}),e(s,{span:18},{default:t(()=>[e(r,{class:"coord-value",type:"info"},{default:t(()=>[u(_(m(n.deviceA.lat)),1)]),_:1})]),_:1})]),_:1}),e(a,null,{default:t(()=>[e(s,{span:6},{default:t(()=>[e(r,{class:"coord-label",type:"info",size:"small"},{default:t(()=>l[1]||(l[1]=[u("经度")])),_:1})]),_:1}),e(s,{span:18},{default:t(()=>[e(r,{class:"coord-value",type:"info"},{default:t(()=>[u(_(m(n.deviceA.lon)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(s,{span:6},{default:t(()=>[x("div",O,_(g.value)+"m",1)]),_:1}),e(s,{span:9},{default:t(()=>[e(a,null,{default:t(()=>[e(s,{span:8,class:"id-column"},{default:t(()=>[e(r,{type:"primary",size:"large",tag:"b"},{default:t(()=>[e(v,null,{default:t(()=>[e(q(A))]),_:1}),u(" ID: "+_(n.deviceB.id),1)]),_:1})]),_:1}),e(s,{span:16},{default:t(()=>[e(a,null,{default:t(()=>[e(s,{span:6},{default:t(()=>[e(r,{class:"coord-label",type:"info",size:"small"},{default:t(()=>l[2]||(l[2]=[u("纬度")])),_:1})]),_:1}),e(s,{span:18},{default:t(()=>[e(r,{class:"coord-value",type:"info"},{default:t(()=>[u(_(m(n.deviceB.lat)),1)]),_:1})]),_:1})]),_:1}),e(a,null,{default:t(()=>[e(s,{span:6},{default:t(()=>[e(r,{class:"coord-label",type:"info",size:"small"},{default:t(()=>l[3]||(l[3]=[u("经度")])),_:1})]),_:1}),e(s,{span:18},{default:t(()=>[e(r,{class:"coord-value",type:"info"},{default:t(()=>[u(_(m(n.deviceB.lon)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])}}}),J=V(U,[["__scopeId","data-v-7341a2a5"]]),W=C({__name:"DistanceToolView",setup(I){const m=b().mqtturl,w=b().mqtttopic,p=F({}),g=B(new Set([1,2,3])),n=B(null),l=L(()=>{const a=Array.from(g.value),c=[];for(let o=0;o<a.length;o++)for(let i=o+1;i<a.length;i++){const d=a[o],f=a[i];p[d]&&p[f]&&c.push({a:p[d],b:p[f]})}return c}),v=()=>{const a={clean:!0,connectTimeout:4e3,clientId:b().mqttclientid,username:b().mqttuser,password:b().mqttpwd,reconnectPeriod:1e3};n.value=N.connect(m,a),n.value.on("connect",()=>{var c;console.log("MQTT Connected"),(c=n.value)==null||c.subscribe(w,o=>{o&&console.error("Subscribe error:",o)})}),n.value.on("message",(c,o)=>{var i;try{const d=JSON.parse(o.toString()),f=Number(d.id);if(!g.value.has(f))return;const y=d.sensors.find(z=>z.name==="RTK");if(!y||!Array.isArray((i=y.data)==null?void 0:i.value))return;const[T,k]=y.data.value;r(f,k,T)}catch(d){console.error("MQTT Message Error:",d)}})},r=(a,c,o)=>{if(!s(c,o)){console.warn(`Invalid coordinates for ${a}: ${c}, ${o}`);return}p[a]={id:a,lat:c,lon:o,updated:Date.now()}},s=(a,c)=>a>=-90&&a<=90&&c>=-180&&c<=180;return Q(()=>{v()}),R(()=>{var a;(a=n.value)==null||a.end()}),(a,c)=>{const o=M("el-col"),i=M("el-row");return h(),D(i,{gutter:20,class:"row-spacing"},{default:t(()=>[(h(!0),P(j,null,$(l.value,(d,f)=>(h(),D(o,{key:f,span:12,class:"distance-col"},{default:t(()=>[e(J,{"device-a":d.a,"device-b":d.b},null,8,["device-a","device-b"])]),_:2},1024))),128))]),_:1})}}});export{W as default};
