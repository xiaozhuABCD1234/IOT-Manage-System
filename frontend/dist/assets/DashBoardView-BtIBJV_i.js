import{s as S,d as $,v as k,c as b,g as l,x as z,y as T,t as _,F as W,a as o,r as f,o as w,_ as A,b as n,z as I,w as s,i as g,A as M}from"./index-DkkrOWQ5.js";import{u as U}from"./config-DlXkem2Y.js";/**
 * @license lucide-vue-next v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=S("cpu",[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]]);/**
 * @license lucide-vue-next v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=S("hard-drive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);/**
 * @license lucide-vue-next v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=S("memory-stick",[["path",{d:"M6 19v-3",key:"1nvgqn"}],["path",{d:"M10 19v-3",key:"iu8nkm"}],["path",{d:"M14 19v-3",key:"kcehxu"}],["path",{d:"M18 19v-3",key:"1vh91z"}],["path",{d:"M8 11V9",key:"63erz4"}],["path",{d:"M16 11V9",key:"fru6f3"}],["path",{d:"M12 11V9",key:"ha00sb"}],["path",{d:"M2 15h20",key:"16ne18"}],["path",{d:"M2 7a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v1.1a2 2 0 0 0 0 3.837V17a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-5.1a2 2 0 0 0 0-3.837Z",key:"lhddv3"}]]),P={class:"dashboard-container"},j={class:"left-content"},E={class:"value-display"},J={class:"current-value"},L={class:"separator"},O={class:"total-value"},R={class:"unit"},Z={class:"progress-container"},K=$({__name:"DataProgressDashboard",props:{value:{type:Number,required:!0,default:0},total:{type:Number,default:null},unit:{type:String,default:""},separator:{type:String,default:"/"},colorThreshold:{type:Number,default:80}},setup(F){const a=F,p=k(()=>Number.isInteger(a.value)?a.value:a.value.toFixed(1)),r=k(()=>{if(typeof a.total=="number"&&a.total>0){const e=(a.value/a.total*100).toFixed(1);return Math.min(Number(e),100)}return a.value}),i=k(()=>{const e=r.value;return e<50?"#409eff":e<80?"#FFEB3B":"#f56c6c"});return(e,B)=>{const u=f("el-progress");return w(),b("div",P,[l("div",j,[z(e.$slots,"default",{},void 0,!0),l("div",E,[l("span",J,_(p.value),1),typeof a.total=="number"?(w(),b(W,{key:0},[l("span",L,_(a.separator),1),l("span",O,_(a.total),1)],64)):T("",!0),l("span",R,_(a.unit),1)])]),l("div",Z,[o(u,{type:"circle",percentage:r.value,width:80,color:i.value},null,8,["percentage","color"])])])}}}),x=A(K,[["__scopeId","data-v-4c5ded95"]]),Q={class:"dashboard-view"},X={class:"metric-title"},Y={class:"metric-title"},ee={class:"metric-title"},C=5,oe=$({__name:"DashBoardView",setup(F){const a=U(),p=n(0),r=n({used:0,total:0}),i=n({used:0,total:0}),e=n(null),B=n(5e3);let u=0;const c=n(!0),v=n(null);function N(){c.value&&(e.value=new WebSocket(a.effectiveWSUrl+"/devops/status"),e.value.onopen=()=>{c.value&&(console.log("WebSocket已连接"),u=0)},e.value.onmessage=d=>{try{const t=JSON.parse(d.data);typeof t.cpu_used=="number"&&(p.value=Number(t.cpu_used.toFixed(1))),r.value={used:parseFloat(h(t.memory_used)),total:parseFloat(h(t.memory_total))},i.value={used:parseFloat(h(t.disk_used)),total:parseFloat(h(t.disk_total))}}catch(t){console.error("数据解析错误:",t)}},e.value.onerror=d=>{c.value&&(console.error("WebSocket错误:",d),V())},e.value.onclose=()=>{c.value&&(console.log("WebSocket连接关闭"),V())})}function h(d){return(d/Math.pow(1024,3)).toFixed(2)}function V(){!c.value||u>=C||(v.value=setTimeout(()=>{console.log(`尝试重新连接 (${u+1}/${C})`),u++,N()},B.value))}return I(()=>{c.value=!1,e.value&&(e.value.onclose=null,e.value.onerror=null,e.value.close(),e.value=null),v.value&&(clearTimeout(v.value),v.value=null)}),N(),(d,t)=>{const y=f("el-icon"),m=f("el-col"),D=f("el-row");return w(),b("div",Q,[o(D,{gutter:20},{default:s(()=>[o(m,{span:8},{default:s(()=>[o(x,{value:p.value,unit:"%"},{default:s(()=>[l("h3",X,[o(y,null,{default:s(()=>[o(M(q))]),_:1}),t[0]||(t[0]=g(" CPU 使用率 "))])]),_:1},8,["value"])]),_:1}),o(m,{span:8},{default:s(()=>[o(x,{value:r.value.used,total:r.value.total,unit:"GB"},{default:s(()=>[l("h3",Y,[o(y,null,{default:s(()=>[o(M(H))]),_:1}),t[1]||(t[1]=g(" 内存使用 "))])]),_:1},8,["value","total"])]),_:1}),o(m,{span:8},{default:s(()=>[o(x,{value:i.value.used,total:i.value.total,unit:"GB"},{default:s(()=>[l("h3",ee,[o(y,null,{default:s(()=>[o(M(G))]),_:1}),t[2]||(t[2]=g(" 磁盘存储 "))])]),_:1},8,["value","total"])]),_:1})]),_:1})])}}});export{oe as default};
