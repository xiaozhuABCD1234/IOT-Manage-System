import{d as L,b as k,e as x,f as R,c as T,a,w as l,r as i,g as V,h as E,i as v,E as c,u as S,o as A,_ as B}from"./index-DkkrOWQ5.js";import{a as F,u as y,b as N}from"./axios_config-BzKZg2zh.js";import"./config-DlXkem2Y.js";const q={login:(g,_)=>{const r=new URLSearchParams;return r.append("grant_type","password"),r.append("username",g),r.append("password",_),r.append("scope",""),r.append("client_id",""),r.append("client_secret",""),F.post("/api/user/auth/token",r)}},D={class:"login-container"},I=L({__name:"LoginView",setup(g){const _=y(),r=S(),w=k(),s=x({username:"",password:"",remember:!1}),f=k(!1),h=x({username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}]}),d=(u,e,o)=>{let t="";if(o){const n=new Date;n.setTime(n.getTime()+o*24*60*60*1e3),t="; expires="+n.toUTCString()}document.cookie=u+"="+(e||"")+t+"; path=/"},b=async()=>{var u,e;try{if(!await((u=w.value)==null?void 0:u.validate()))return;f.value=!0;const t=await q.login(s.username,s.password);console.log("登录响应:",t);const{access_token:n,token_type:m}=t.data;_.setToken(n),s.remember?(d("access_token",n,30),d("token_type",m,30)):(d("access_token",n),d("token_type",m)),c.success("登录成功"),await r.push("/")}catch(o){N.isAxiosError(o)?((e=o.response)==null?void 0:e.status)===401?c.error("用户名或密码错误"):c.error(`登录失败: ${o.message}`):(c.error("发生未知错误"),console.error(o))}finally{f.value=!1}};return R(()=>{y().logout()}),(u,e)=>{const o=i("el-input"),t=i("el-form-item"),n=i("el-checkbox"),m=i("el-button"),C=i("el-form"),U=i("el-card");return A(),T("div",D,[a(U,{class:"login-card"},{default:l(()=>[e[5]||(e[5]=V("div",{class:"login-header"},[V("h2",null,"用户登录")],-1)),a(C,{ref_key:"loginFormRef",ref:w,model:s,rules:h,onKeyup:E(b,["enter"])},{default:l(()=>[a(t,{prop:"username"},{default:l(()=>[a(o,{modelValue:s.username,"onUpdate:modelValue":e[0]||(e[0]=p=>s.username=p),placeholder:"请输入用户名","prefix-icon":"User",clearable:""},null,8,["modelValue"])]),_:1}),a(t,{prop:"password"},{default:l(()=>[a(o,{modelValue:s.password,"onUpdate:modelValue":e[1]||(e[1]=p=>s.password=p),placeholder:"请输入密码","prefix-icon":"Lock","show-password":"",clearable:""},null,8,["modelValue"])]),_:1}),a(t,{prop:"remember"},{default:l(()=>[a(n,{modelValue:s.remember,"onUpdate:modelValue":e[2]||(e[2]=p=>s.remember=p)},{default:l(()=>e[3]||(e[3]=[v("记住我")])),_:1},8,["modelValue"])]),_:1}),a(t,null,{default:l(()=>[a(m,{type:"primary",onClick:b,loading:f.value,style:{width:"100%"}},{default:l(()=>e[4]||(e[4]=[v(" 登录 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])]),_:1})])}}}),$=B(I,[["__scopeId","data-v-a6c03eae"]]);export{$ as default};
