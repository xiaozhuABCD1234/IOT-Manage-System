// ---------- 可调参数 ----------
#let soft-name = "基于RTK与UWB融合定位的展示平台"
#let soft-ver = "V1.0.0"
#let doc-type = "用户手册"

#set heading(numbering: "1.1.1") //设置标题格式

// ---------- 页眉函数 ----------
#let soft-header() = context {
  set text(size: 10.5pt, font: ("SimSun", "Songti SC", "serif"))
  smallcaps(soft-name) + h(1fr) + str(counter(page).at(here()).first())
  v(2pt, weak: true)
  line(length: 100%, stroke: 0.25pt)
}

// ---------- 封面 ----------
#let cover() = {
  align(center)[
    #text(size: 20pt, weight: "bold", soft-name + " " + soft-ver) \
    #v(3em)
    // 关键：把下面这句包进 place 里，让它在页面垂直居中
    #place(center + horizon, text(size: 20pt, doc-type))
  ]
  pagebreak()
}

// ---------- 全局设置 ----------
#set page(
  margin: (top: 2.8cm, bottom: 2.5cm, x: 2cm),
  header: soft-header(),
  numbering: none, // 已在页眉自定义
)
// 两端对齐
#set par(justify: true)
// 先排封面
#cover()


// ---------- 正文 ----------
// #counter(page).update(0)     // 封面不占页码，正文从 1 开始

#outline(title: "目录")
#pagebreak()
#counter(page).update(1)
#set page(
  margin: (top: 2.8cm, bottom: 2.5cm, x: 2cm),
  header: soft-header(),
  numbering: none, // 已在页眉自定义
)



= 软件简介
== 开发背景
随着物联网技术的快速发展，室内外精确定位需求日益增长，尤其在电力施工等高风险场景中，人员与设备的安全监控成为重中之重。RTK（实时动态载波相位差分技术）与UWB（超宽带）融合定位技术结合了RTK的厘米级室外定位精度和UWB的室内高精度定位优势，为电力施工场景提供了无缝的定位解决方案。通过实时精确的位置跟踪，可以有效监控施工人员进入危险区域、设备碰撞预警、作业边界管控等，显著提升施工安全水平。本展示平台旨在直观展示RTK与UWB融合定位的效果，特别针对电力施工安全场景，为相关行业提供可视化演示和功能验证。

== 软件介绍
基于RTK与UWB融合定位的展示平台是一个集成了实时定位、地图展示、设备管理、电子围栏和智能预警功能的前端可视化系统。平台通过现代化的Web界面，为用户提供直观、交互式的定位体验，特别针对电力施工等高风险场景，提供人员安全监控、设备防碰撞预警、作业区域管控等关键安全功能，支持多地图类型、实时数据更新和丰富的管理功能。

== 面向用户
- 定位技术研究人员
- 物联网系统集成商
- 设备管理与运维人员
- 项目演示与展示人员

== 主要功能
- 多地图展示：支持高德地图（RTK室外定位）和自定义平面图（UWB室内定位）
- 实时定位监控：实时显示设备位置，支持轨迹追踪
- 设备管理：设备标记、分类、标签管理
- 电子围栏：室内外电子围栏创建与管理
- 距离监控：设备间距离实时计算与预警
- 基站管理：定位基站配置与可视化
- 用户系统：多级权限管理与安全认证

== 优势创新
1. *技术融合创新*：实现了RTK与UWB技术的无缝融合，提供室内外一体化定位解决方案。
2. *电力施工安全*：针对电力施工高风险场景，提供人员安全监控、设备防碰撞预警、作业区域管控等专业安全功能。
3. *可视化交互*：现代化的前端界面，提供直观的地图展示和实时数据更新。
4. *智能预警*：集成电子围栏和距离监控，实现主动安全预警，有效预防安全事故。
5. *多地图支持*：支持标准地图和自定义地图，适应不同应用场景。
6. *开放架构*：基于微服务架构，易于扩展和集成其他系统。

= 运行环境
== 硬件环境
- 服务器：x86_64架构，4核CPU，8GB内存，100GB存储空间
- 客户端：支持现代浏览器的PC或移动设备
- 网络：稳定的互联网连接，支持WebSocket通信

== 软件环境
- 操作系统：Windows 10/11，macOS 10.14+，Linux Ubuntu 18.04+
- 浏览器：Chrome 90+，Firefox 88+，Safari 14+，Edge 90+
- 运行依赖：Node.js 20.19.0+，Docker 20.10+（可选）

= 技术栈
== 软件技术
- *前端框架*：Vue 3.5.18 + TypeScript 5.8 + Vite
- *UI组件库*：Radix Vue + Tailwind CSS 4.1
- *地图服务*：高德地图API + 自定义Canvas绘制
- *实时通信*：MQTT.js 5.14+（WebSocket）
- *状态管理*：Pinia 3.0+
- *路由管理*：Vue Router 4.5+
- *HTTP客户端*：Axios 1.11+

== 架构设计
展示平台采用前后端分离架构：
- *前端*：单页面应用（SPA），基于Vue 3构建，通过API Gateway与后端微服务通信
- *通信协议*：HTTP/RESTful API用于数据交互，MQTT over WebSocket用于实时位置推送
- *安全机制*：JWT令牌认证，7天自动过期，路由守卫保护

== 数据模型
- *设备标记*（Mark）：设备基本信息、类型、标签、位置状态
- *基站*（Station）：定位基站坐标、名称、状态
- *电子围栏*（PolygonFence）：多边形顶点、名称、激活状态
- *用户*（User）：用户名、密码哈希、权限等级

= 软件功能

== 用户登录与认证
=== 登录界面
用户访问系统首先进入登录页面，输入用户名和密码进行认证。系统支持多级权限（Root/Admin/User），不同权限用户可访问的功能不同。
#image("assets/image-1.png")
=== 安全特性
- JWT令牌认证，有效期7天
- 自动令牌刷新机制
- 路由守卫保护未授权访问
- 密码加密传输与存储

== 首页概览
登录成功后进入首页，展示系统轮播图，突出显示“地图总览”和“定位平台”两大核心功能模块，为用户提供直观的入口。

#image("./assets/image.png")

== 地图展示功能
=== RTK地图（室外定位）
使用高德地图作为底图，展示RTK设备的室外定位信息：
1. *地图操作*：缩放、平移、定位等基本操作
2. *设备显示*：实时显示设备位置，不同设备类型使用不同图标
3. *轨迹追踪*：显示设备历史轨迹路径
4. *电子围栏*：绘制和管理室外多边形电子围栏
#image("assets/image-2.png")

=== UWB地图（室内定位）
使用自定义平面图作为底图，展示UWB设备的室内定位信息：
1. *地图上传*：支持上传PNG、JPG、GIF、WEBP格式的平面图
2. *坐标系配置*：设置地图比例尺和坐标原点
3. *实时散点图*：在Canvas上实时绘制设备位置
4. *基站显示*：显示UWB定位基站位置
5. *室内围栏*：创建和管理室内电子围栏
#image("assets/image-3.png")

== 设备管理
=== 设备状态监控
实时显示所有设备的在线状态、最后在线时间、当前位置等信息，支持按类型和标签过滤。

=== 设备标记管理
提供设备的CRUD（创建、读取、更新、删除）功能：
1. *创建设备*：输入设备ID、名称、选择类型和标签
2. *设备列表*：分页展示所有设备，支持搜索和筛选
3. *设备编辑*：修改设备基本信息
4. *设备删除*：移除不需要的设备记录
#image("assets/image-4.png")

=== 标签与类型管理
- *标签管理*：创建和管理设备标签，用于设备分类
- *类型管理*：创建设备类型，定义类型间的默认安全距离
#figure(image("assets/image-5.png",width: 50%))
== 距离监控与安全设置
=== 设备对距离配置
设置特定设备对之间的安全距离阈值，当设备间距离超过阈值时触发警报。

=== 批量距离设置
提供多种批量配置方式：
1. *组合设置*：选择多个设备，统一设置安全距离
2. *笛卡尔积设置*：为两组设备间的所有组合设置相同距离
3. *类型默认距离*：设置同类型设备间的默认安全距离
#image("assets/image-6.png")

=== 实时距离监控
系统实时计算设备间距离，并在超过安全距离时：
1. 前端界面显示警报提示
2. 通过MQTT发布警报消息
3. 触发设备声光警报（如设备支持）

== 电子围栏管理
=== 围栏创建
1. *绘制围栏*：在地图上点击绘制多边形围栏
2. *围栏属性*：设置围栏名称、描述、激活状态
3. *围栏类型*：区分室内围栏和室外围栏
#figure(image("assets/image-8.png"))
#figure(image("assets/image-9.png"))
=== 围栏检测
系统实时检测设备是否进入或离开电子围栏：
1. *实时检测*：设备位置更新时自动检测围栏状态
2. *警报触发*：设备进入围栏时触发警报
3. *状态缓存*：避免重复警报，智能限流

=== 围栏管理
提供围栏的列表展示、编辑和删除功能，支持围栏激活/停用控制。

== 基站管理
=== 基站配置
管理UWB定位基站信息：
1. *基站添加*：设置基站名称、坐标位置
2. *基站列表*：展示所有基站信息
3. *基站编辑*：修改基站配置
4. *基站删除*：移除不需要的基站
#image("assets/image-7.png")

=== 基站可视化
在地图上显示基站位置，支持基站状态监控。

== 用户个人资料
=== 个人信息查看
查看当前登录用户的基本信息，包括用户名、权限等级等。

=== 密码修改
提供密码修改功能，确保账户安全。

== 实时通信
=== MQTT连接
通过WebSocket连接MQTT Broker，订阅以下主题：
1. `location/#`：设备位置数据
2. `warning/#`：设备警报信息
3. `online/#`：设备在线状态

=== 数据更新机制
- *位置更新*：实时接收设备位置并在地图上更新
- *警报显示*：实时显示设备警报状态
- *状态同步*：设备在线状态实时同步

== 系统设置
=== 地图设置
管理自定义地图：
1. *地图上传*：上传室内平面图
2. *地图列表*：管理已上传的地图
3. *默认地图*：设置默认显示的地图

=== 围栏设置
专用页面管理所有电子围栏，提供批量操作功能。

= 使用指南

== 快速开始
1. 访问系统网址（如：http://localhost:3000）
2. 使用默认账号登录（用户名：admin，密码：admin）
3. 进入首页，选择需要使用的功能模块

== 地图使用指南
1. *切换地图类型*：通过顶部导航栏切换RTK地图和UWB地图
2. *设备位置查看*：在地图上查看设备实时位置，点击设备图标查看详情
3. *围栏绘制*：在RTK地图或UWB地图中点击"开始绘制围栏"按钮，在地图上点击绘制多边形

== 设备管理指南
1. *添加设备*：进入"设备管理"页面，点击"添加设备"按钮
2. *设备分组*：使用标签和类型对设备进行分类管理
3. *状态监控*：在"设备状态"页面查看所有设备实时状态

== 距离监控设置
1. *安全距离设置*：进入"距离设置"页面
2. *选择配置方式*：根据需求选择"设备对"、"组合"或"笛卡尔积"设置
3. *设置阈值*：输入安全距离数值（单位：厘米）

== 警报处理
1. *警报查看*：当设备触发警报时，系统会显示警报提示
2. *警报确认*：点击警报提示查看详细信息
3. *警报处理*：根据情况采取相应措施

= 常见问题解答

== 登录问题
1. *无法登录*：检查用户名密码是否正确，确认网络连接正常
2. *登录后自动退出*：检查浏览器Cookie设置，确保允许本地存储

== 地图显示问题
1. *地图不显示*：检查网络连接，确认高德地图API密钥配置正确
2. *设备位置不更新*：检查MQTT连接状态，确认设备正常发送数据

== 设备管理问题
1. *无法添加设备*：检查设备ID是否重复，确认必填字段已填写
2. *设备状态不正确*：检查设备最后在线时间，确认设备正常通信

== 警报问题
1. *警报不触发*：检查安全距离设置，确认设备间距离计算正确
2. *警报重复触发*：系统有限流机制，避免警报风暴

= 维护与支持

== 系统维护
1. *定期备份*：建议定期备份系统配置数据
2. *日志查看*：通过浏览器开发者工具查看前端日志
3. *版本更新*：关注系统版本更新，及时升级

== 技术支持
- 问题反馈：通过系统内反馈功能提交问题
- 文档查阅：参考本用户手册和在线API文档
- 社区支持：加入技术社区获取帮助

== 联系信息
如需进一步技术支持，请联系系统管理员或开发团队。

= 附录

== 术语解释
- *RTK*：实时动态载波相位差分技术，提供厘米级室外定位精度
- *UWB*：超宽带技术，提供分米级室内定位精度
- *电子围栏*：虚拟的地理边界，用于检测设备进出特定区域
- *MQTT*：消息队列遥测传输协议，轻量级的发布/订阅消息传输协议

== 版本历史
#table(
  columns: (auto, auto, 1fr),
  align: center,
  [*版本*], [*日期*], [*更新内容*],
  [V1.0.0], [2025-12-22], [初始版本发布，包含基本定位展示和设备管理功能],
)
